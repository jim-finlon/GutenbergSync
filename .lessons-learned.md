# Lessons Learned

## Project Planning Phase

### Documentation Best Practices
- **Version control for docs**: Increment version numbers when making significant changes
- **Comprehensive requirements**: Include all improvements upfront to avoid scope creep
- **User stories**: Help clarify acceptance criteria and priorities
- **Technical specs**: Detailed enough to guide implementation without being prescriptive

### Key Insights

1. **Metadata-First Strategy**: Building catalog before content sync provides early value and better tracking
2. **Incremental Operations**: Critical for large datasets - saves significant time on re-runs
3. **Selective Extraction**: Enables targeted RAG dataset creation without full processing
4. **Quality Metrics**: Important for ensuring RAG data quality - catch issues early
5. **Configuration Validation**: Fail fast with clear errors - better UX than runtime failures

### Design Decisions

- **Auto-detection over configuration**: rsync discovery reduces setup friction
- **Database path flexibility**: Default to target directory but allow override
- **Concurrent operations**: Enable parallel workflows with proper safety mechanisms
- **Multiple export formats**: Support different use cases (RAG, analytics, ML)

### Areas for Future Consideration

- Performance benchmarks for large archives (76K+ books)
- Caching strategies for frequently accessed metadata
- Compression options for extracted chunks
- Integration with popular RAG frameworks (optional enhancement)

## Implementation Notes

### Technology Updates
- **2025-12-08**: Updated from .NET 8.0 LTS to .NET 9.0 for latest features and performance improvements
- C# 13 language features available with .NET 9.0

### Bug Fixes
- **2025-12-08**: Fixed directory writability validation bug - newly created directories were not being checked for write permissions. Now validates writability for both existing and newly created directories in all validation methods (sync.targetDirectory, catalog.databasePath, extraction.outputDirectory, logging.filePath). Fix verified and implementation restored.

- **2025-12-08**: Fixed ApplyEnvironmentOverrides bug - method was void and discarded changes to immutable record. Changed to return AppConfiguration and assign result. Environment variable overrides now work correctly.

- **2025-12-08**: Fixed WSL rsync discovery bug - returned "wsl rsync" as executable path which failed in ProcessStartInfo. Now returns "wsl" and uses separate method GetRsyncVersionFromWSLAsync with proper argument handling. Version detection works for WSL installations.

### Code Quality Lessons
- Always validate permissions after creating directories, not just when they already exist
- Test both code paths (directory exists vs. directory created) for validation logic
- Early validation catches permission issues before runtime failures

*To be updated as implementation progresses*

